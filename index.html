<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم جامعة الأقصى الشاملة</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --gold: #c59d3f; --dark: #1a1a1a; --grey: #f4f7f6; }
        body { margin: 0; font-family: 'Cairo', sans-serif; background: #fff; color: var(--dark); }
        
        /* الهيدر والواجهة */
        header { background: #fff; padding: 10px 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; position: sticky; top:0; z-index: 100; }
        .hero { height: 300px; background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; color: white; position: relative; }
        .hero::after { content: ""; position: absolute; inset: 0; background: rgba(0,0,0,0.5); }
        .hero h1 { z-index: 2; font-size: 1.5rem; text-align: center; }

        .container { max-width: 900px; margin: auto; padding: 20px; }
        .card { background: var(--grey); padding: 20px; border-radius: 12px; margin-bottom: 20px; border-right: 5px solid var(--gold); }

        /* لوحة التحكم الاحترافية */
        #adminArea { display: none; background: #fff; position: fixed; inset: 0; z-index: 1000; overflow-y: auto; padding: 20px; }
        .admin-nav { display: flex; gap: 10px; overflow-x: auto; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid var(--grey); }
        .nav-link { padding: 10px 20px; background: var(--grey); border-radius: 20px; cursor: pointer; white-space: nowrap; }
        .nav-link.active { background: var(--gold); color: white; }
        
        input, textarea, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-family: 'Cairo'; box-sizing: border-box; }
        .btn { background: var(--gold); color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>

    <header>
        <strong>جامعة الأقصى للعلوم والتكنولوجيا</strong>
        <button onclick="openAdmin()" style="border:none; background:none; font-size:1.2rem; cursor:pointer;">⚙️</button>
    </header>

    <div class="hero" id="heroBg" style="background-image: url('https://via.placeholder.com/1200x400');">
        <h1 id="mainTitle">جاري تحميل البيانات...</h1>
    </div>

    <div class="container">
        <h2 style="border-right: 4px solid var(--gold); padding-right: 10px;">آخر الأخبار</h2>
        <div id="newsList"></div>

        <div class="card">
            <h3>الرؤية والرسالة</h3>
            <p id="visionText"></p>
        </div>
    </div>

    <div id="adminArea">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>لوحة إدارة النظام</h2>
            <button onclick="closeAdmin()" style="background:red; color:white; border:none; padding:5px 15px; border-radius:5px;">إغلاق</button>
        </div>

        <div class="admin-nav">
            <div class="nav-link active" onclick="showTab('tab1', this)">الإعدادات العامة</div>
            <div class="nav-link" onclick="showTab('tab2', this)">عن الجامعة</div>
            <div class="nav-link" onclick="showTab('tab3', this)">إدارة الأخبار</div>
        </div>

        <div id="tab1" class="tab-content active">
            <label>عنوان الموقع الرئيسي:</label>
            <input type="text" id="setMainTitle">
            <label>تغيير صورة الغلاف (رفع مباشر):</label>
            <input type="file" id="heroFile" accept="image/*">
            <button class="btn" onclick="updateGeneral()">حفظ الإعدادات العامة</button>
        </div>

        <div id="tab2" class="tab-content">
            <label>نص الرؤية والرسالة:</label>
            <textarea id="setVision" rows="4"></textarea>
            <label>اسم المؤسس:</label>
            <input type="text" id="setFounder">
            <label>رئيس الجامعة:</label>
            <input type="text" id="setPresident">
            <button class="btn" onclick="updateAbout()">تحديث بيانات الجامعة</button>
        </div>

        <div id="tab3" class="tab-content">
            <label>عنوان الخبر:</label>
            <input type="text" id="newsT">
            <label>تفاصيل الخبر:</label>
            <textarea id="newsD"></textarea>
            <label>صورة الخبر:</label>
            <input type="file" id="newsF" accept="image/*">
            <button class="btn" style="background:#27ae60" onclick="postNews()">نشر الخبر الآن</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCymqlC7QfKyS_XY73zjHkDW-IK3KcBCxI",
            databaseURL: "https://alaqsa-university-6c2ad-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const imgbbKey = "6d84033e9d80c05a6396b27e4e08611a";

        // مزامنة البيانات
        db.ref('fullSite').on('value', (snap) => {
            const data = snap.val();
            if(data) {
                document.getElementById('mainTitle').innerText = data.title || "";
                document.getElementById('visionText').innerText = data.vision || "";
                if(data.hero) document.getElementById('heroBg').style.backgroundImage = `url('${data.hero}')`;
                
                // ملء اللوحة
                document.getElementById('setMainTitle').value = data.title || "";
                document.getElementById('setVision').value = data.vision || "";
                document.getElementById('setFounder').value = data.founder || "";
                document.getElementById('setPresident').value = data.president || "";
            }
        });

        // جلب الأخبار
        db.ref('news').on('value', (snap) => {
            let html = "";
            snap.forEach(child => {
                const n = child.val();
                html += `<div class="card"><img src="${n.img}" style="width:100%; border-radius:8px;"><h3>${n.title}</h3><p>${n.desc}</p></div>`;
            });
            document.getElementById('newsList').innerHTML = html;
        });

        function showTab(id, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        async function uploadToImgBB(file) {
            const fd = new FormData(); fd.append("image", file);
            const res = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbKey}`, {method:"POST", body:fd});
            const json = await res.json();
            return json.data.url;
        }

        function openAdmin() {
            const p = prompt("كلمة المرور:");
            if(p === "sayhi1322") document.getElementById('adminArea').style.display = 'block';
        }
        function closeAdmin() { document.getElementById('adminArea').style.display = 'none'; }

        async function updateGeneral() {
            const title = document.getElementById('setMainTitle').value;
            const file = document.getElementById('heroFile').files[0];
            let url = null;
            if(file) url = await uploadToImgBB(file);
            db.ref('fullSite').update({ title, ...(url && {hero: url}) });
            alert("تم التحديث!");
        }

        async function postNews() {
            const title = document.getElementById('newsT').value;
            const desc = document.getElementById('newsD').value;
            const file = document.getElementById('newsF').files[0];
            if(!file) return alert("اختر صورة");
            const img = await uploadToImgBB(file);
            db.ref('news').push({ title, desc, img });
            alert("تم النشر!");
        }

        function updateAbout() {
            db.ref('fullSite').update({
                vision: document.getElementById('setVision').value,
                founder: document.getElementById('setFounder').value,
                president: document.getElementById('setPresident').value
            });
            alert("تم التحديث!");
        }
    </script>
</body>
</html>
